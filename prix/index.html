<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
      var available = {
        romains: {
          celier: false,
          cuisine: false,
          grandeD: false,
          grandeG: false,
          balcon: false,
        },
        engel: {
          salon: false,
          sud: false,
          nord: false,
          ouest: false,
        },
      };

      var prix = {
        insurance: 9,
        romains: {
          available: true, // computed
          charges: [
            {
              date: "01/09/2024",
              price: 75,
            },
          ],
          caution: [
            {
              date: "01/09/2024",
              price: 675,
            },
          ],
          rooms: [
            {
              available: available.romains.celier,
              labelFR: "Chambre Ouest côté celier",
              labelEN: "West bedroom, cellar side",
              img: "./romains/position-celier.jpg",
              size: 9,
              price_history: [
                {
                  date: "01/09/2024",
                  price: 349,
                },
                {
                  date: "01/02/2025",
                  price: 355,
                },
              ],
            },
            {
              available: available.romains.cuisine,
              labelFR: "Chambre Est côté cuisine",
              labelEN: "East bedroom, kitchen side",
              img: "./romains/position-cuisine.jpg",
              size: 9,
              price_history: [
                {
                  date: "01/09/2024",
                  price: 349,
                },
                {
                  date: "01/02/2025",
                  price: 356,
                },
              ],
            },
            {
              available: available.romains.grandeG,
              labelFR: "Grande chambre (gauche)",
              labelEN: "Large bedroom (left)",
              img: "./romains/position-grandeG.jpg",
              size: 11,
              price_history: [
                {
                  date: "01/09/2024",
                  price: 370,
                },
                {
                  date: "01/02/2025",
                  price: 370,
                },
              ],
            },
            {
              available: available.romains.grandeD,
              labelFR: "Grande chambre (droite)",
              labelEN: "Large bedroom (right)",
              img: "./romains/position-grandeD.jpg",
              size: 11,
              price_history: [
                {
                  date: "01/09/2024",
                  price: 371,
                },
                {
                  date: "01/02/2025",
                  price: 371,
                },
              ],
            },
            {
              available: available.romains.balcon,
              labelFR: "Chambre Ouest avec balcon",
              labelEN: "West bedroom with balcony",
              img: "./romains/position-balcon.jpg",
              size: 9,
              price_history: [
                {
                  date: "01/09/2024",
                  price: 360,
                },
                {
                  date: "01/02/2025",
                  price: 375,
                },
              ],
            },
          ],
        },

        engel: {
          available: true, // computed
          charges: [
            {
              date: "01/04/2023",
              price: 85,
            },
          ],
          caution: [
            {
              date: "01/04/2023",
              price: 750,
            },
          ],
          rooms: [
            {
              available: available.engel.salon,
              labelFR: "Chambre sud salon",
              labelEN: "South bedroom",
              size: 10,
              price_history: [
                {
                  date: "01/04/2023",
                  price: 398,
                },
              ],
            },
            {
              available: available.engel.ouest,
              labelFR: "Chambre Ouest",
              labelEN: "West bedroom",
              size: 11,
              price_history: [
                {
                  date: "01/04/2023",
                  price: 410,
                },
              ],
            },
            {
              available: available.engel.nord,
              labelFR: "Grande chambre nord",
              labelEN: "Large North bedroom",
              size: 13,
              price_history: [
                {
                  date: "01/04/2023",
                  price: 421,
                },
                {
                  date: "21/02/2025",
                  price: 426,
                },
              ],
            },
            {
              available: available.engel.sud,
              labelFR: "Grande chambre sud",
              labelEN: "Large south bedroom",
              size: 15,
              price_history: [
                {
                  date: "01/04/2023",
                  price: 435,
                },
              ],
            },
          ],
        },
      };
      var flatEnabled = (stack, room) => room.available || stack;
      prix.engel.available = prix.engel.rooms.reduce(flatEnabled, false);
      prix.romains.available = prix.romains.rooms.reduce(flatEnabled, false);
    </script>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🏠</text></svg>"
    />
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prix Chambre Appartement</title>
    <style>
      body {
        padding: 20px 30px;
        user-select: none;
      }
      label {
        white-space: nowrap !important;
        padding-right: 10px;
        cursor: pointer;
      }
      li b,
      ul:not(#flats) li span {
        display: inline-block;
        text-align: right;
        width: 85px;
        padding-right: 15px;
        font-size: 110%;
      }
      li u {
        display: inline-block;
        width: 170px;
        text-decoration: none;
      }
      li.apl-checkbox {
        list-style-type: none;
        margin-left: -18px;
      }
      li.apl-checkbox input {
        margin-right: 2px;
      }
      li.apl-checkbox b {
        margin-left: 18px;
      }
      li.plus {
        list-style-type: "+ ";
        margin-left: -2px;
        margin-right: 2px;
        color: darkgrey;
      }
      h3 {
        white-space: nowrap;
      }
      .nowrap {
        white-space: nowrap;
      }
      .disabled {
        color: grey;
      }
      #flats li,
      #rooms li {
        list-style-type: none;
      }
      #room-image {
        max-height: 360px;
      }
      #rooms {
        min-height: 154px;
      }
      li i {
        color: #a6a6a6;
      }
      @media (max-width: 800px) {
        li i {
          display: block;
          padding-right: 30px;
        }
      }
      @media (max-width: 576px) {
        li i {
          display: none;
        }
        #rooms {
          min-height: 0;
        }
      }
      .container {
        margin-left: 0 !important;
        padding-left: 0 !important;
      }
    </style>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <h1 class="fr">💰 Prix des chambres pour l'appartement</h1>
    <h1 class="en">💰 Room prices for the flat</h1>

    <div class="mb-4">
      <label>
        <input onClick="javascript:fr();" type="radio" name="lang" checked />
        🇫🇷 Français
      </label>
      <label>
        <input onClick="javascript:en();" type="radio" name="lang" />
        🇬🇧 English
      </label>
    </div>

    <p class="fr">
      Voici la liste de tous les frais liés à l'appartement. <br /><i
        >Ces frais seront les mêmes pour n'importe quelle location et son donc
        important à prendre en compte dans votre budget.</i
      >
    </p>
    <p class="en">
      Here is a list of all the costs associated with the flat. <br /><i
        >These costs will be be the same for any rental and are therefore
        important for your budget.</i
      >
    </p>

    <div class="container">
      <div class="row">
        <div class="col-4 col-md-6">
          <h3 class="fr">🏠 Appartement</h3>
          <h3 class="en">🏠 Flat</h3>
          <ul id="flats">
            <li>
              <label id="engel-available">
                <span id="engel-available-icon"></span>&nbsp;
                <input
                  onClick="javascript:engel();"
                  type="radio"
                  name="flat"
                  checked
                />
                💎 Engelbreit
              </label>
            </li>
            <li>
              <label id="romains-available">
                <span id="romains-available-icon"></span>&nbsp;
                <input
                  onClick="javascript:romains();"
                  type="radio"
                  name="flat"
                />
                ✨ Romains
              </label>
            </li>
          </ul>

          <h3 class="fr">🛏️ Chambre</h3>
          <h3 class="en">🛏️ Room</h3>
          <div class="mb-4">
            <p class="fr nowrap">Choisissez une chambre:</p>
            <p class="en nowrap">Please pick one</p>
            <ul id="rooms"></ul>
          </div>
        </div>
        <div class="col-4 d-none d-md-block">
          <img id="room-image" src="" alt="" />
        </div>
      </div>
    </div>

    <h3 class="fr">💰 Prix</h3>
    <h3 class="en">💰 Cost</h3>

    <div class="mb-4 room">
      <h6 class="fr roomFR"></h6>
      <h6 class="en roomEN"></h6>
      <b class="fr">📆 Par mois:</b>
      <b class="en">📆 Per month:</b>
      <ul>
        <li class="fr">
          <u>Loyer:</u> <b class="loyer">0€</b>
          <i></i>
        </li>
        <li class="en">
          <u>Rent:</u> <b class="loyer">0€</b>
          <i></i>
        </li>
        <li class="apl-checkbox">
          <u>
            <input
              type="checkbox"
              id="apl-checkbox"
              onClick="javascript:room()"
            />
            <label class="fr" for="apl-checkbox">Éligible APL ?</label>
            <label class="en" for="apl-checkbox">Eligible for APL ?</label>
          </u>
          <b class="apl">0€</b>
          <i class="fr"> aide au logement de la CAF</i>
          <i class="en"> CAF housing benefit</i>
        </li>
        <li class="fr">
          <u>Charges:</u> <b class="charges">0€</b>
          <i
            >comprend 💧 eau, ♨️ eau chaude, 🌡️ chauffage, 💡 électricité, et la
            🌐 fibre internet.
          </i>
        </li>
        <li class="en">
          <u>Charges:</u> <b class="charges">0€</b>
          <i>
            includes 💧 water, ♨️ hot water, 🌡️ heating, 💡 electricity and 🌐
            fiber internet.
          </i>
        </li>
        <li>
          <u>Total:</u> <span class="total">0€</span>
          <i></i>
        </li>
        <li class="fr plus">
          <u>Assurance habitation:</u> <span class="insurance">0€</span>
          <i>obligatoire pour toute location en 🇫🇷 France </i>
        </li>
        <li class="en plus">
          <u>Home Insurance:</u> <span class="insurance">0€</span>
          <i> mandatory for any rental in 🇫🇷 France</i>
        </li>
      </ul>
      <b class="fr">☝️ Une fois / rendu au départ:</b>
      <b class="en">☝️ One time / sent back on departure:</b>
      <ul>
        <li class="fr">
          <u>Caution:</u> <span class="caution">0€</span>
          <i>à l'entrée, peut être échelonné</i>
        </li>
        <li class="en">
          <u>Deposit:</u> <span class="caution">0€</span>
          <i>at the entrance, can be staggered</i>
        </li>
        <li class="fr">
          <u><s>Frais d'agence:</s></u> <span>0 €</span>
          <i>vous traitez en direct avec moi, aucun frais d'agence</i>
        </li>
        <li class="en">
          <u><s>Agency fees:</s></u> <span>0 €</span>
          <i>you deal directly with me, no agency fees</i>
        </li>
      </ul>
    </div>

    <script type="text/javascript">
      function $(selector) {
        var result = Array.from(document.querySelectorAll(selector));
        return result.length === 1 ? result[0] : result;
      }

      var admin = false;
      document.addEventListener("keydown", (event) => {
        if (event.key === "p") {
          admin = !admin;
          $("#engel-available input").disabled = !admin;
          $("#romains-available input").disabled = !admin;
          loadRooms();
        }
      });

      function FRDate(chaineDate) {
        var [day, month, year] = chaineDate.split("/");
        return new Date(year, month - 1, day);
      }
      function lastPrice(prices) {
        var lastDate = "01/01/1970";
        var currentPrice = 0;
        prices.forEach(({ date, price }) => {
          if (FRDate(date) > FRDate(lastDate)) {
            lastDate = date;
            currentPrice = price;
          }
        });
        return currentPrice;
      }
      Object.prototype.set = function (content) {
        Array.isArray(this)
          ? this.map((e) => (e.innerHTML = content))
          : (this.innerHTML = content);
      };
      Object.prototype.setE = function (content) {
        return this.set(lastPrice(content) + " €");
      };
      function toggleDisplay(type) {
        return (elem) => (elem.style.display = type);
      }
      function show() {
        return toggleDisplay("");
      }
      function hide() {
        return toggleDisplay("none");
      }
      var currentLanguage = "fr";
      function fr() {
        $(".fr").map(show());
        $(".en").map(hide());
        currentLanguage = "fr";
      }
      function en() {
        $(".fr").map(hide());
        $(".en").map(show());
        currentLanguage = "en";
      }
      function setLangage() {
        currentLanguage == "fr" ? fr() : en();
      }
      var currentFlat = "engel";
      var urlParams = new URLSearchParams(window.location.search);
      var flat = urlParams.get("flat");
      if (flat) {
        currentFlat = flat;
        $(`#${currentFlat}-available input`).click();
      } else if (!prix.engel.available && prix.romains.available) {
        currentFlat = "romains";
        $("#romains-available input").click();
      }
      function engel() {
        currentFlat = "engel";
        loadRooms();
      }
      function romains() {
        currentFlat = "romains";
        loadRooms();
      }

      function loadRooms() {
        var html = "";
        var IDalreadySelected = -1;

        prix[currentFlat].rooms?.forEach(
          ({ available, labelFR, labelEN, size, price_history }, index) => {
            if (available && IDalreadySelected < 0) {
              IDalreadySelected = index;
            }
            var checked = IDalreadySelected == index ? "checked" : "";
            var availableIcon = available ? "✅" : "❌";
            var disabled = admin || available ? "" : `disabled="disabled"`;
            html += `
              <li>
                <label>
                  ${availableIcon}&nbsp;
                  <input onClick="javascript:room(${index});" type="radio" name="room" ${checked} ${disabled}/>
                  <font class="fr">${labelFR}</font> <font class="en">${labelEN}</font> - ${size}m²
                </label>
              </li>
              `;
          }
        );
        if (IDalreadySelected === -1) {
          IDalreadySelected = 0;
        }

        $("#rooms").set(html);
        room(IDalreadySelected);
        setLangage();
      }

      var lastRoomIndex = -1;
      function room(index = lastRoomIndex) {
        lastRoomIndex = index;
        var flat = prix[currentFlat];
        var { caution, charges } = flat;
        var { labelFR, labelEN, size, price_history, img } = flat.rooms[index];

        var hasAPL = $("#apl-checkbox").checked;
        var totalPrice =
          lastPrice(price_history) + lastPrice(charges) - (hasAPL ? 100 : 0);

        $(".roomFR").set(labelFR);
        $(".roomEN").set(labelEN);
        $(".loyer").setE(price_history);
        $(".apl").set(hasAPL ? "-100 €" : "0 €");
        $(".charges").setE(charges);
        $(".caution").setE(caution);
        $(".total").set(totalPrice + " €");

        $("#room-image").src = img || "";
      }

      $(".insurance").set("≈ " + prix.insurance + " €");
      $("#engel-available-icon").set(prix.engel.available ? "✅" : "❌");
      $("#romains-available-icon").set(prix.romains.available ? "✅" : "❌");
      $("#engel-available input").disabled = !prix.engel.available;
      $("#romains-available input").disabled = !prix.romains.available;
      setLangage();
      loadRooms();
    </script>
  </body>
</html>
